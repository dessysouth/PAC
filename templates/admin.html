<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PAC || Admin</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Muli:300,400,700,900"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/bootstrap.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/jquery-ui.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/owl.carousel.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/owl.theme.default.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/jquery.fancybox.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/bootstrap-datepicker.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='fonts/flaticon/font/flaticon.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/jquery.mb.YTPlayer.min.css') }}"
      media="all"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='fonts/icomoon/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <!-- Custom CSS for button icons -->
    <style>
      .nav-link {
        color: #007bff;
      }
      .btn-icon {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 12px;
        text-decoration: none;
        color: #fff;
        transition: all 0.3s;
        background-color: #007bff;
      }

      .btn-icon:hover,
      .btn-icon:focus {
        color: inherit;
        text-decoration: none;
      }

      .btn-icon:hover .btn-text,
      .btn-icon:focus .btn-text {
        opacity: 1;
        transform: translateX(0);
      }

      .btn-text {
        position: absolute;
        left: 100%; /* Adjust this value based on your design */
        padding-left: 8px; /* Add padding between icon and text */
        white-space: nowrap;
        opacity: 0;
        transition: all 0.3s;
        transform: translateX(100%);
      }
      .btn-generate-id-card {
        background-color: #28a745;
        color: #ffffff;
      }
      .toggle-button {
        background-color: #007bff;
      }
      .toggle-icon {
        float: right; /* Align icon to the right */
      }
      /* Default styles */
      .site-section {
        padding: 20px;
      }

      .table th,
      .table td {
        vertical-align: middle;
      }

      .table img {
        max-width: 100%;
        height: auto;
      }

      /* Media query for mobile devices */
      @media (max-width: 768px) {
        .site-logo {
          width: 50px;
        }
        .col-lg-4 {
          margin-top: 20px;
        }

        .nav-tabs .nav-item {
          flex: 1 1 100%;
          text-align: center;
        }

        .nav-tabs .nav-link {
          padding: 10px 15px;
        }

        .tab-content .table {
          width: 100%;
          overflow-x: auto;
          display: block;
        }

        .tab-content .table thead {
          display: none;
        }

        .tab-content .table tbody tr {
          display: flex;
          flex-direction: column;
          margin-bottom: 1rem;
          border-bottom: 1px solid #ddd;
          padding-bottom: 1rem;
        }

        .tab-content .table tbody tr td {
          display: flex;
          justify-content: flex-start;
          align-items: center;
          padding: 5px 0;
        }

        .tab-content .table tbody tr td::before {
          content: attr(data-label);
          flex: 1;
          font-weight: bold;
          margin-right: 10px;
        }

        .row.justify-content-center {
          margin-left: 0 !important;
        }

        .row.justify-content-center + .row.justify-content-center {
          margin-top: 20px;
        }

        .btn-block {
          width: 100%;
          margin-bottom: 10px;
        }

        .tab-content .table tbody tr td a,
        .tab-content .table tbody tr td form {
          display: block;
          margin-bottom: 10px;
          width: 100%;
        }

        .vertical-buttons {
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .vertical-buttons .btn {
          width: 100%;
          margin-bottom: 10px;
        }
      }

      @media (max-width: 576px) {
        .nav-tabs .nav-link {
          padding: 8px 10px;
        }

        .tab-content .table tbody tr td {
          padding: 3px 0;
        }

        .btn-block {
          margin-bottom: 15px;
        }
      }
    </style>
  </head>

  <body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">
    <div class="site-wrap">
      <!-- Mobile Menu -->
      <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
          <div class="site-mobile-menu-close mt-3">
            <span class="icon-close2 js-menu-toggle"></span>
          </div>
        </div>
        <div class="site-mobile-menu-body"></div>
      </div>
      <div
        class="site-logo"
        style="
          margin-left: 30px;
          margin-top: 10px;
          position: fixed;
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 100%;
        "
      >
        <a href="{{ url_for('home') }}" class="d-block">
          <img
            style="width: 100px"
            src="{{ url_for('static', filename='images/WhatsApp_Image_2024-03-08_at_08.55.48_e7c7c63c.png') }}"
            alt="Image"
            class="img-fluid"
          />
        </a>
        <div style="margin-right: 40px" class="vertical-buttons">
          <!-- Hamburger button for toggling options -->
          <button
            class="btn btn-primary rounded-0 px-4 toggle-button"
            data-toggle="collapse"
            data-target="#toggle-buttons"
            aria-expanded="false"
            aria-controls="toggle-buttons"
          >
            <i class="fas fa-bars"></i>
            <!-- Font Awesome icon for hamburger -->
          </button>

          <!-- Collapsible content for the buttons -->
          <div class="collapse" id="toggle-buttons">
            <div class="btn-group-vertical mt-2">
              <a
                style="margin-top: 10px; background-color: red; color: #fff"
                href="{{ url_for('admin.create_instructor') }}"
                class="btn btn-secondary rounded-0 px-4"
              >
                Create Instructor Profile
              </a>
              <a
                style="margin-top: 20px; background-color: red; color: #fff"
                href="{{ url_for('admin.add_course') }}"
                class="btn btn-secondary rounded-0 px-4"
              >
                Add New Course
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="site-section">
        <div class="row mb-5 justify-content-center text-center">
          <div class="col-lg-4 mt-5">
            <h2 class="section-title-underline">
              <span>Admin Page</span>
            </h2>
          </div>
        </div>
        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs" id="adminTabs" role="tablist">
          <li class="nav-item">
            <a
              class="nav-link active"
              id="courses-tab"
              data-toggle="tab"
              href="#courses"
              role="tab"
              aria-controls="courses"
              aria-selected="true"
              >Courses</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="instructors-tab"
              data-toggle="tab"
              href="#instructors"
              role="tab"
              aria-controls="instructors"
              aria-selected="false"
              >Instructors</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="students-tab"
              data-toggle="tab"
              href="#students"
              role="tab"
              aria-controls="students"
              aria-selected="false"
              >Students</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="cart-tab"
              data-toggle="tab"
              href="#cart"
              role="tab"
              aria-controls="cart"
              aria-selected="false"
              >Cart Items</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="payments-tab"
              data-toggle="tab"
              href="#payments"
              role="tab"
              aria-controls="payments"
              aria-selected="false"
              >Payments</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="course-materials-tab"
              data-toggle="tab"
              href="#course-materials"
              role="tab"
              aria-controls="course-materials"
              aria-selected="false"
              >Course Materials</a
            >
          </li>
        </ul>
        <!-- Tab Contents -->
        <div class="tab-content" id="adminTabsContent">
          <!-- Courses Tab -->
          <div
            class="tab-pane fade show active"
            id="courses"
            role="tabpanel"
            aria-labelledby="courses-tab"
          >
            <section>
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Instructor</th>
                    <th>Price</th>
                    <th>Duration</th>
                    <th>Materials</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for course in courses %}
                  <tr>
                    <td data-label="ID">{{ course.id }}</td>
                    <td data-label="Title">{{ course.title }}</td>
                    <td data-label="Category">{{ course.category }}</td>
                    <td data-label="Instructor">
                      {% if course.instructor %} {{ course.instructor.fullname
                      }} {% else %} No Instructor {% endif %}
                    </td>
                    <td data-label="Price">{{ course.price }}</td>
                    <td data-label="Duration">{{ course.duration }}</td>
                    <td data-label="Materials">
                      <a
                        href="{{ url_for('admin.upload_material', course_id=course.id) }}"
                        class="btn btn-secondary"
                        >Upload Material</a
                      >
                    </td>
                    <td data-label="Actions">
                      <!-- Edit Button -->
                      <a
                        href="{{ url_for('admin.edit_course', course_id=course.id) }}"
                        class="btn btn-success btn-icon"
                        aria-label="Edit"
                      >
                        <i class="fas fa-edit"></i>
                        <!-- Font Awesome icon for edit -->
                        <span class="btn-text"></span>
                        <!-- Text that appears on hover/click -->
                      </a>
                      <!-- Delete Form Button -->
                      <form
                        action="{{ url_for('admin.delete_course', course_id=course.id) }}"
                        method="POST"
                        style="display: inline-block"
                      >
                        <button
                          type="submit"
                          class="btn btn-delete btn-icon"
                          style="background-color: red; color: #fff"
                          onclick="return confirm('Are you sure you want to delete this course?');"
                          aria-label="Delete"
                        >
                          <i class="fas fa-trash-alt"></i>
                          <!-- Font Awesome icon for delete -->
                          <span class="btn-text"></span>
                          <!-- Text that appears on hover/click -->
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </section>
          </div>
          <!-- Instructors Tab -->
          <div
            class="tab-pane fade"
            id="instructors"
            role="tabpanel"
            aria-labelledby="instructors-tab"
          >
            <section>
              <table class="table">
                <!-- Table headers -->
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Profile Image</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>House Address</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for instructor in instructors %}
                  <tr>
                    <!-- Display instructor data -->
                    <td data-label="ID">{{ instructor.id }}</td>
                    <td data-label="Profile Image">
                      {% if instructor.profile_image %}
                      <img
                        src="{{ url_for('static', filename='profile_images/' + instructor.profile_image) }}"
                        alt="Profile Image"
                        width="60"
                        style="border-radius: 100px; height: 60px"
                      />
                      {% else %} No Image {% endif %}
                    </td>
                    <td data-label="Full Name">{{ instructor.fullname }}</td>
                    <td data-label="Email">{{ instructor.email }}</td>
                    <td data-label="Phone Number">
                      {{ instructor.phone_number }}
                    </td>
                    <td data-label="House Address">
                      {{ instructor.house_address }}
                    </td>
                    <td data-label="Actions">
                      <!-- Edit Button -->
                      <a
                        href="{{ url_for('admin.edit_instructor', instructor_id=instructor.id) }}"
                        class="btn btn-success btn-icon"
                        aria-label="Edit"
                      >
                        <i class="fas fa-edit"></i>
                        <span class="btn-text"></span>
                        <!-- Text that appears on hover/click -->
                      </a>
                      <!-- Delete Form Button -->
                      <form
                        action="{{ url_for('admin.delete_instructor', instructor_id=instructor.id) }}"
                        method="POST"
                        style="display: inline-block"
                      >
                        <button
                          type="submit"
                          class="btn btn-danger btn-icon"
                          style="background-color: red; color: #fff"
                          onclick="return confirm('Are you sure you want to delete this instructor?');"
                          aria-label="Delete"
                        >
                          <i class="fas fa-trash-alt"></i>
                          <!-- Font Awesome icon for delete -->
                          <span class="btn-text"></span>
                          <!-- Text that appears on hover/click -->
                        </button>
                      </form>
                      <!-- Button to generate identity card -->
                      <button
                        class="btn btn-success btn-generate-id-card"
                        data-type="instructor"
                        data-id="{{ instructor.id }}"
                        onclick="fetchAndShowProfile('instructor', {{ instructor.id }});"
                      >
                        Generate ID Card
                      </button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </section>
          </div>

          <!-- Students Tab -->

          <div
            class="tab-pane fade"
            id="students"
            role="tabpanel"
            aria-labelledby="students-tab"
          >
            <section>
              <table class="table">
                <!-- Table headers -->
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Profile Image</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>House Address</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for student in students %}
                  <tr>
                    <!-- Display student data -->
                    <td data-label="ID">{{ student.id }}</td>
                    <td data-label="Profile Image">
                      {% if student.profile_image %}
                      <img
                        src="{{ url_for('static', filename='uploads/' + student.profile_image) }}"
                        alt="{{ student.firstname }}"
                        width="60"
                        style="border-radius: 100px; height: 60px"
                      />
                      {% else %} No Image {% endif %}
                    </td>
                    <td data-label="First Name">{{ student.firstname }}</td>
                    <td data-label="Last Name">{{ student.lastname }}</td>
                    <td data-label="Email">{{ student.user.email }}</td>
                    <td data-label="Phone Number">
                      {{ student.phone_number }}
                    </td>
                    <td data-label="House Address">
                      {{ student.house_address }}
                    </td>
                    <td data-label="Actions">
                      <!-- Edit Button -->
                      <a
                        href="{{ url_for('admin.edit_student_profile', student_id=student.id) }}"
                        class="btn btn-success btn-icon"
                        aria-label="Edit"
                      >
                        <i class="fas fa-edit"></i>
                        <span class="btn-text"></span>
                        <!-- Text that appears on hover/click -->
                      </a>
                      <!-- Delete Form Button -->
                      <form
                        action="{{ url_for('admin.delete_student', student_id=student.id) }}"
                        method="POST"
                        style="display: inline-block"
                      >
                        <button
                          type="submit"
                          class="btn btn-danger btn-icon"
                          style="background-color: red; color: #fff"
                          onclick="return confirm('Are you sure you want to delete this student?');"
                          aria-label="Delete"
                        >
                          <i class="fas fa-trash-alt"></i>
                          <!-- Font Awesome icon for delete -->
                          <span class="btn-text"></span>
                          <!-- Text that appears on hover/click -->
                        </button>
                      </form>
                      <!-- Button to generate identity card -->
                      <button
                        class="btn btn-success btn-generate-id-card"
                        data-type="student"
                        data-id="{{ student.id }}"
                        onclick="fetchAndShowProfile('student', {{ student.id }});"
                      >
                        Generate ID Card
                      </button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </section>
          </div>

          <!-- Cart Items Tab -->
          <div
            class="tab-pane fade"
            id="cart"
            role="tabpanel"
            aria-labelledby="cart-tab"
          >
            <section>
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Course Title</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>User Email</th>
                    <th>User Phone</th>
                    <th>Date Added</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in cart_items %}
                  <tr>
                    <td data-label="ID">{{ item.id }}</td>
                    <td data-label="Course Title">{{ item.course.title }}</td>
                    <td data-label="Category">{{ item.course.category }}</td>
                    <td data-label="Price">#{{ item.course.price }}</td>
                    <td data-label="User Email">{{ item.user.email }}</td>
                    <td data-label="User Phone">
                      {{ item.user.student_profile.phone_number }}
                    </td>
                    <td data-label="Date Added">
                      {{ item.date_added.strftime('%Y-%m-%d') }}
                    </td>
                    <td data-label="Actions">
                      <form
                        action="{{ url_for('admin.admin_remove_from_cart', cart_id=item.id) }}"
                        method="POST"
                        style="display: inline-block"
                      >
                        <button type="submit" class="btn btn-danger">
                          Remove
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </section>
          </div>
          <!-- Payments Tab -->
          <div
            class="tab-pane fade"
            id="payments"
            role="tabpanel"
            aria-labelledby="payments-tab"
          >
            <section>
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Course</th>
                    <th>Amount</th>
                    <th>Reference</th>
                    <th>Status</th>
                    <th>Timestamp</th>
                  </tr>
                </thead>
                <tbody>
                  {% for payment in payments %}
                  <tr>
                    <td data-label="ID">{{ payment.id }}</td>
                    <td data-label="User">
                      {% if payment.user %} {{ payment.user.username }} {% else
                      %} Unknown {% endif %}
                    </td>
                    <td data-label="Course">
                      {% if payment.course %} {{ payment.course.title }} {% else
                      %} Unknown {% endif %}
                    </td>
                    <td data-label="Amount"># {{ payment.amount }}</td>
                    <td data-label="Reference">{{ payment.reference }}</td>
                    <td data-label="Status">{{ payment.status }}</td>
                    <td data-label="Timestamp">{{ payment.timestamp }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </section>
          </div>
          <!-- Course Materials Tab -->
          <div
            class="tab-pane fade"
            id="course-materials"
            role="tabpanel"
            aria-labelledby="course-materials-tab"
          >
            <section>
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Course Title</th>
                    <th>Filename</th>
                    <th>Description</th>
                    <th>Date Added</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for material in course_materials %}
                  <tr>
                    <td data-label="ID">{{ material.id }}</td>
                    <td data-label="Course Title">
                      {{ material.course.title }}
                    </td>
                    <td data-label="Filename">{{ material.filename }}</td>

                    <td data-label="Description">{{ material.description }}</td>
                    <td data-label="Date Added">
                      {{ material.date_added.strftime('%Y-%m-%d') }}
                    </td>
                    <td data-label="Actions">
                      <!-- Edit button with icon -->
                      <a
                        href="{{ url_for('admin.edit_material', material_id=material.id) }}"
                        class="btn btn-success btn-icon"
                        aria-label="Edit"
                      >
                        <i class="fas fa-edit"></i>
                        <!-- Font Awesome icon for edit -->
                        <span class="btn-text"></span>
                        <!-- Text that appears on hover/click -->
                      </a>

                      <!-- Delete button with icon -->
                      <form
                        action="{{ url_for('admin.delete_material', material_id=material.id) }}"
                        method="POST"
                        style="display: inline-block"
                      >
                        <button
                          type="submit"
                          class="btn btn-danger btn-icon"
                          style="background-color: red; color: #fff"
                          onclick="return confirm('Are you sure you want to delete this material?');"
                          aria-label="Delete"
                        >
                          <i class="fas fa-trash-alt"></i>
                          <!-- Font Awesome icon for delete -->
                          <span class="btn-text"></span>
                          <!-- Text that appears on hover/click -->
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </section>
          </div>
        </div>
      </div>

      <div id="loader" class="show fullscreen">
        <svg class="circular" width="68px" height="68px">
          <circle
            class="path-bg"
            cx="24"
            cy="24"
            r="22"
            fill="none"
            stroke-width="4"
            stroke="#eeeeee"
          />
          <circle
            class="path"
            cx="24"
            cy="24"
            r="22"
            fill="none"
            stroke-width="4"
            stroke-miterlimit="10"
            stroke="#51be78"
          />
        </svg>
      </div>
      <a href="#" id="back-to-top" class="back-to-top">
        <span>&uarr;</span>
      </a>
      <!-- Identity Card Modal -->
      <div
        class="modal fade"
        id="identityCardModal"
        tabindex="-1"
        aria-labelledby="identityCardModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="identityCardModalLabel">
                Identity Card
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <!-- Profile data will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
              <button id="btn-print" class="btn btn-secondary">Print</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Include necessary JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-migrate-3.0.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/owl.carousel.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.stellar.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.countdown.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap-datepicker.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.easing.1.3.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.fancybox.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.sticky.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.mb.YTPlayer.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
      $(document).ready(function () {
        $("#adminTabs a").on("click", function (e) {
          e.preventDefault();
          $(this).tab("show");
        });
      });
    </script>

    <script>
      function fetchAndShowProfile(type, id) {
        console.log(`Fetching profile: Type=${type}, ID=${id}`);
        $.ajax({
          url: "/fetch_profile/" + type + "/" + id,
          type: "GET",
          success: function (response) {
            console.log(`Fetched profile: Type=${type}, ID=${id}`);
            // Update the modal body with profile data
            $("#identityCardModal .modal-body").html(response);
            // Show the modal
            $("#identityCardModal").modal("show");

            // Attach save and print functionality
            $("#btn-save")
              .off("click")
              .on("click", function () {
                saveIdentityCard(type, id);
              });

            $("#btn-print")
              .off("click")
              .on("click", function () {
                printIdentityCard();
              });
          },
          error: function (xhr, status, error) {
            console.error(
              `Error fetching profile: Type=${type}, ID=${id}, Error=${error}`
            );
            alert("Failed to fetch profile data.");
          },
        });
      }

      function saveIdentityCard(profileType, id) {
        $.ajax({
          url: `/generate_identity_card/${profileType}/${id}`,
          type: "GET",
          success: function (data) {
            if (data.success) {
              // Directly trigger download without using form submission
              window.location.href =
                "/download_identity_card?file_path=" +
                encodeURIComponent(data.file_path);
              alert("Identity card saved successfully!");
            } else {
              console.error("Failed to save identity card:", data.error);
              alert("Failed to save identity card.");
            }
          },
          error: function (xhr, status, error) {
            console.error("Error saving identity card:", error);
            alert("Failed to save identity card.");
          },
        });
      }

      function printIdentityCard() {
        window.print();
      }

      $(document).ready(function () {
        // Activate tabs using Bootstrap's tab plugin
        $("#adminTabs a").on("click", function (e) {
          e.preventDefault();
          $(this).tab("show");
        });

        // Button click event handler for generating identity card
        $(".btn-generate-id-card").click(function (e) {
          e.preventDefault();
          var type = $(this).data("type");
          var id = $(this).data("id");

          // Call fetchAndShowProfile function to fetch and display profile
          fetchAndShowProfile(type, id);
        });
      });
    </script>
  </body>
</html>
